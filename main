#!/usr/bin/perl
# Evan Miller 8/16/16
# Conglomerate perl DB IO functions in to an application

# includes
use DBI;
use strict;
use warnings;
use diagnostics;
use Glib 'TRUE', 'FALSE';
use feature 'say';
use Switch;

## global vars
# database handler
my $dbh = DBI->connect('DBI:mysql:db_dev0:localhost','dbdev','dbdev');
my $numInput = 9;
my $strInput = "";
my $introd = 0;
my $greeting = "Welcome to Socman!";
my $mainFuncmenu = "1. Travel 
2. Sign 
3. Exhibition 
4. Roster 
5. Add Team
6. Add Player
7. Add Locale
8. Table Create
9. Table DROP
10. Table Print
0. Exit";
my $loc = 1;
my $team = 1;



mainFunc();

sub mainFunc {
    while ($numInput != 0) {
        if ($introd == 0) {
            say $greeting;
            $introd++;
        }
        say "$mainFuncmenu"; 
        $numInput = <STDIN>;
        chomp $numInput;
        say "You chose $numInput";
        switch ($numInput) {
            case "1"    { doTravel() }
            case "2"    { doSign() }
            case "3"    { doExhib() }
            case "4"    { printRoster() }
            case "5"    { addTeam() }
            case "6"    { addPlayer() }
            case "7"    { addLocale() }
            case "8"    { tableCreate() }
            case "9"   { tableDrop() }
            case "10"   { tablePrint() }
            case "0"    { say "Goodybe!" }
            else        { say "Try again." }
        }
    }
    
}
sub doTravel {
    
}
sub doSign {
}
sub doExhib {
}
sub printRoster {
}
sub addTeam {
}
sub addLocale {
}



sub tableCreate {
    sub tableCreateLocales {
        my $sql = qq/CREATE TABLE `Locales` (
        `varID`         int(11)         NOT NULL    auto_increment,
        `varName`       varchar(50)     NOT NULL    default '',
        `varDefMod`     int(2)          NOT NULL    default 0,
        `varOffMod`     int(2)          NOT NULL    default 0,
        `varMidMod`     int(2)          NOT NULL    default 0,
        `varGKMod`      int(2)          NOT NULL    default 0,
        PRIMARY KEY (`varID`)
        );/;
        my $sth = $dbh->prepare($sql);
        $sth->execute;
    }
    sub tableCreatePlayers {
        my $sql = qq/CREATE TABLE `Players` (
        `varID`         int(11)         NOT NULL    auto_increment,
        `varName`       varchar(25)     NOT NULL    default '',
        `varHome`       int(11)         NOT NULL    default 0,
        `varDef`        int(3)          NOT NULL    default 0,
        `varOff`        int(3)          NOT NULL    default 0,
        `varMid`        int(3)          NOT NULL    default 0,
        `varGK`         int(3)          NOT NULL    default 0,
        PRIMARY KEY (`varID`)
        );/;
        my $sth = $dbh->prepare($sql);
        $sth->execute;
    }
    sub tableCreateTeams {
        my $sql = qq/CREATE TABLE `Teams` (
        `varID`         int(11)         NOT NULL    auto_increment,
        `varName`       varchar(25)     NOT NULL    default '',
        `varHome`       int(11)         NOT NULL    default 0,
        PRIMARY KEY (`varID`)
        );/;
        my $sth = $dbh->prepare($sql);
        $sth->execute;
    }
    sub tableCreateRosters {
        my $sql = qq/CREATE TABLE `Rosters` (
        `transID`       int(11)         NOT NULL    auto_increment,
        `playerID`      int(11)         NOT NULL    default 0,
        `teamID`        int(11)         NOT NULL    default 0,   
        `rosterSpot`    int(11)         NOT NULL    default 0,
        PRIMARY KEY (`transID`)
        );/;
        my $sth = $dbh->prepare($sql);
        $sth->execute;
    }
    tableCreateLocales();
    tableCreatePlayers();
    tableCreateTeams();
    tableCreateRosters();
    return TRUE;
}

sub tableLineCreate {
    sub lineCreateLocales {
        my $sql = qq/INSERT INTO Locales (varName, varDefMod, varOffMod, varMidMod, varGKMod)
            values ("Columbus", 4, 3, 2, 2);/;
        my $sth = $dbh->prepare($sql);
        $sth->execute();
    }
    sub lineCreatePlayers {
        my $sql = qq/INSERT INTO Players (varName, varHome, varDef, varOff, varMid, varGK)
            values ("Messi", 1, 9, 8, 7, 6);/;
        my $sth = $dbh->prepare($sql);
        $sth->execute();
    }
    sub lineCreateTeams {
        my $sql = qq/INSERT INTO Teams (varName, varHome)
            values ("Kickers", 1);/;
        my $sth = $dbh->prepare($sql);
        $sth->execute();
    }
    sub lineCreateRosters {
        my $sql = qq/INSERT INTO Rosters (playerID, teamID, rosterSpot)
            values (1, 1, 1);/;
        my $sth = $dbh->prepare($sql);
        $sth->execute();
    }
    lineCreateLocales();
    lineCreatePlayers();
    lineCreateTeams();
    lineCreateRosters();
    return TRUE;
}
    
sub tableDrop {
    say "Which tables? ALL for all.";
    my $strInput = <STDIN>;
    my $sql = "";
    chomp $strInput;
    if ($strInput eq "ALL"){
        say "Dropping ALL tables";
        $sql = qq/DROP TABLE Locales, Players, Teams, Rosters;/;
    } else {
        say "Dropping table $strInput";
        $sql = qq/DROP TABLE $strInput;/;
    }
    my $sth = $dbh->prepare($sql);
    $sth->execute();
    say "Tables DROPPED";
}    

sub tablePrint {
    my $p1 = "";
    if (!$_[0]) {
        say "Print which table?";
        $p1 = <STDIN>; 
    } else {
        $p1 = $_[0];
    }
    chomp $p1;
    my $sql = qq/SELECT * FROM $p1/;
    my $sth = $dbh->prepare($sql);
    $sth->execute();
    my ($col1, $col2, $col3, $col4, $col5, $col6);
    $sth->bind_col(1, \$col1);
    $sth->bind_col(2, \$col2);
    $sth->bind_col(3, \$col3);
    $sth->bind_col(4, \$col4);
    $sth->bind_col(5, \$col5);
    $sth->bind_col(6, \$col6);
    while ($sth->fetch) {
    say "ID: $col1, Name: $col2, Def: $col3, Off: $col4, Mid: $col5, GK: $col6";
    }
    if (!$col1){
    say "Nothing in table.";
    }   
    return TRUE;
}

